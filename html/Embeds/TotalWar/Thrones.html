<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Total War THRONES OF BRITANNIA</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      overflow: hidden;
      margin: 0;
      padding: 20px;
      background: transparent;
      font-family: 'Rubik', sans-serif;
      color: #eeebebbe;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #ffffff;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      margin: 8px 0;
      padding: 6px 12px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
    }

    a {
      color: #eeebebbe;
      text-decoration: none;
    }

    a:hover {
      text-decoration: none;
      color: rgba(253, 255, 255, 0.72) ! important;
    }

    li img {
      height: 20px;
      vertical-align: middle;
      margin-right: 8px;
    }

    #fileList {
      height: 600px;
      overflow-y: auto;
      padding-right: 10px;
      scrollbar-width: none;
    }

    #fileList li {
      margin: 8px 0;
      padding: 6px 12px;
      background-color: rgba(96, 95, 95, 0.05);
      border-radius: 6px;
      backdrop-filter: blur(1px);
      transition:
        transform 0.15s ease,
        background-color 0.2s ease;
      will-change: transform;
      font-weight: 500;
      font-size: 14px;
      font-family: 'Poppins', monospace;
      color: #eeebebbe;
      cursor: pointer;
    }

    #fileList li.folder-open {
      background-color: rgba(255, 255, 255, 0.055);
    }

    #fileList li:hover:not(:has(.folder-open-button:hover)) {
      background-color: rgba(255, 255, 255, 0.055);
    }

    #fileList::-webkit-scrollbar {
      display: none;
    }

    #fileList li.highlighted {
      background: rgba(128, 128, 128, 0.09);
      backdrop-filter: blur(50px);
      border: 1px solid rgba(255, 255, 255, 0.02);
      color: #eeebebbe;
      transition: background 0.3s ease;
      backdrop-filter: brightness(-0.5);
      font-weight: 600;
      cursor: pointer;
    }

    #fileList li.highlighted:hover {
      border: 1.5px solid rgba(128, 128, 128, 0.1);
      transition:
        transform 0.15s ease,
        background 0.1s ease-in,
        border 0.5s ease;
      will-change: transform;
    }

    #fileList li.folder-entry span {
      display: inline-block;
      transform-style: preserve-3d;
      transition: transform 0.2s ease;
      will-change: transform;
    }

    #fileList li .file-entry a {
      display: inline-block;
      transform-style: preserve-3d;
      transition: transform 0.2s ease;
      will-change: transform;
    }

    .file-size-tag {
      background: rgba(120, 120, 120, 0.25);
      color: rgb(170, 170, 170, 0.8);
      padding: 2px 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-left: auto;
      white-space: nowrap;
      font-family: 'Poppins', monospace;
      font-weight: 600;
    }

    .file-count-tag {
      background: rgba(120, 120, 120, 0.25);
      color: rgb(170, 170, 170, 0.8);
      padding: 2px 8px;
      border-radius: 5px;
      font-size: 12px;
      margin-left: 6px;
      white-space: nowrap;
      font-family: 'Poppins', monospace;
      font-weight: 600;
    }

    .file-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .file-entry:hover a {
      color: rgba(253, 255, 255, 0.72);
    }

    .file-entry img:hover {
      filter: brightness(1.2);
      transform: scale(1.1);
      transition: transform 0.2s ease, filter 0.2s ease;
      cursor: pointer;
    }

    .folder-entry img:hover {
      filter: brightness(1.2);
      transform: scale(1.1);
      transition: transform 0.2s ease, filter 0.2s ease;
    }

    li.folder-open .folder-entry img {
      filter: brightness(1.3);
      transform: scale(1.1);
    }

    .folder-arrow {
      width: 12px;
      height: 12px;
      margin-right: 6px;
      transition: transform 0.2s ease;
      fill: #9b9b9bc9;
      flex-shrink: 0;
    }

    .folder-arrow.open {
      transform: rotate(90deg);
    }

    .folder-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      color: #eeebebbe;
      position: relative;
    }

    .folder-entry:hover {
      color: rgba(253, 255, 255, 0.75);
      cursor: pointer;
    }

    .folder-open-button {
      background: rgba(255, 255, 255, 0.05);
      border: none;
      padding: 6px;
      margin-left: 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.25s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: none;
      cursor: pointer;
      position: relative;
    }

    .folder-open-button:hover {
      background: rgba(255, 255, 255, 0.12);
      filter: brightness(1.2);
      transform: translateX(0.5px) scale(1.1);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .folder-open-button:hover .icon-animated {
      filter: brightness(1);
      transform: translateX(0.5px) scale(1.2);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .folder-open-button svg {
      width: 18px;
      height: 18px;
    }

    .folder-open-button svg path:first-child {
      fill: rgba(2, 161, 50, 0.8);
      opacity: 0.7;
    }

    .folder-open-button svg path.arrow-part {
      fill: rgba(2, 161, 50, 0.8);
      opacity: 0.7;
    }

    .folder-open-button:hover .arrow-part {
      fill: rgba(2, 161, 50, 0.8);
      opacity: 0.7;
    }

    .custom-tooltip {
      position: absolute;
      bottom: 15px;
      left: -40px;
      transform: translateX(-50%);
      background: rgba(50, 50, 50, 0.6);
      color: #a1a1a179;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      font-weight: 700;
      font-family: 'Poppins', monospace;
      transition: opacity 0.2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      z-index: 10;
      border: 1px solid rgb(255, 255, 255, 0.05);
    }

    .folder-open-button:hover .custom-tooltip {
      opacity: 1;
      pointer-events: auto;
      transition-delay: 180ms;
    }
  </style>
</head>

<body>
  <h1><img src="https://justkaarlo.github.io/JustKaarlo-Google-Site/resources/icons/TotalWar_Thrones.png" alt="Thrones"
      style="height: 27px; vertical-align: middle; margin-right: 10px; margin-bottom: 4px; margin-left: 25px;" />Thrones
    of Britannia
  </h1></img>
  <ul id="fileList" style="margin: 10px 15px 0px 15px;">Loading...</ul>

  <script>
    const rootFolderId = "1vizoQOE_gq9rK9LgrxeNgFoikw75AX2h";
    const apiKey = "AIzaSyDqtsRN35V1JnmfIY9hTsn_Ej4aSipsK4M";

    const customIcons = {
      "Thrones Extra Modifications.exe": "https://justkaarlo.github.io/JustKaarlo-Google-Site/resources/icons/GoogleDriveIcons/Custom/TotalWarThronesExtras.ico",
      "Age of Arthur.exe": "https://justkaarlo.github.io/JustKaarlo-Google-Site/resources/icons/GoogleDriveIcons/Custom/AgeOfArthur.ico",
    };

    const customFolderIcons = {
      "1MsU5Q9-uQ23a0anq3ZsH4RdZ-0CkiAiU": "https://justkaarlo.github.io/JustKaarlo-Google-Site/resources/icons/GoogleDriveIcons/Custom/DragonEmpire.ico",
    };

    function formatBytes(bytes) {
      const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
      if (bytes === 0) return "0 Bytes";
      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)), 10);
      return parseFloat((bytes / Math.pow(1024, i)).toFixed(1)) + " " + sizes[i];
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h, s, l };
    }

    function hslToRgb(h, s, l) {
      let r, g, b;
      if (s === 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1 / 6) return p + (q - p) * 6 * t;
          if (t < 1 / 2) return q;
          if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
          return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
      }
      return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
      };
    }

    function adjustLightness({ r, g, b }, delta = 0.15) {
      const { h, s, l } = rgbToHsl(r, g, b);
      const nl = Math.max(0, Math.min(1, l + delta));
      return hslToRgb(h, s, nl);
    }

    function rgbaStr({ r, g, b }, a) {
      return `rgba(${r}, ${g}, ${b}, ${a})`;
    }

    function getAverageColorFromImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => {
          try {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d", { willReadFrequently: true });
            const w = 24, h = 24;
            canvas.width = w;
            canvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);
            const { data } = ctx.getImageData(0, 0, w, h);
            let r = 0, g = 0, b = 0, count = 0;

            for (let i = 0; i < data.length; i += 4 * 2) {
              const a = data[i + 3];
              if (a < 64) continue;
              r += data[i];
              g += data[i + 1];
              b += data[i + 2];
              count++;
            }
            if (!count) return reject("no_pixels");
            resolve({
              r: Math.round(r / count),
              g: Math.round(g / count),
              b: Math.round(b / count)
            });
          } catch (e) {
            reject(e);
          }
        };
        img.onerror = () => reject("load_error");
        img.src = src;
      });
    }

    function applyGradientToItemFromSrc(li, src, fallbackKey) {
      getAverageColorFromImage(src).then(base => {
        const light = adjustLightness(base, +0.18);
        const dark = adjustLightness(base, -0.18);
        li.style.backgroundImage = `linear-gradient(135deg, ${rgbaStr(light, 0.18)} 0%, ${rgbaStr(dark, 0.35)} 100%)`;
        li.style.border = `1px solid ${rgbaStr(dark, 0.22)}`;
        li.style.backdropFilter = 'blur(1px)';
      }).catch(() => {
        if (fallbackKey && folderGradientFallback[fallbackKey]) {
          li.style.backgroundImage = folderGradientFallback[fallbackKey];
          li.style.border = `1px solid rgba(255,255,255,0.06)`;
        } else {
          li.style.backgroundImage = `linear-gradient(135deg, rgba(120,120,120,0.12), rgba(60,60,60,0.24))`;
          li.style.border = `1px solid rgba(255,255,255,0.05)`;
        }
      });
    }

    async function listFilesInFolder(folderId, container, path = "") {
      container.innerHTML = "";
      const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+trashed=false&key=${apiKey}&fields=files(id,name,mimeType,webViewLink,iconLink,size)`;
      const res = await fetch(url);
      const data = await res.json();

      if (!data.files || data.files.length === 0) {
        const li = document.createElement("li");
        li.textContent = "No files found.";
        container.appendChild(li);
        return;
      }

      const files = data.files.filter(f => f.mimeType !== "application/vnd.google-apps.folder");
      const folders = data.files.filter(f => f.mimeType === "application/vnd.google-apps.folder");

      files.sort((a, b) => {
        if (a.name === "Thrones Extra Modifications.exe") return -1;
        if (b.name === "Thrones Extra Modifications.exe") return 1;
        return a.name.localeCompare(b.name, undefined, { numeric: true });
      });
      folders.sort((a, b) => a.name.localeCompare(b.name, undefined, { numeric: true }));

      for (const file of files) {
        const li = document.createElement("li");
        if (file.name === "Thrones Extra Modifications.exe") {
          li.classList.add("highlighted");
        }

        const link = document.createElement("a");
        link.style.display = 'inline-block';
        link.style.transformStyle = 'preserve-3d';
        link.style.transition = 'transform 0.2s ease';

        link.addEventListener('mousemove', (e) => {
          const rect = link.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const midX = rect.width / 2;
          const midY = rect.height / 2;

          const rotateX = ((y - midY) / midY) * 2;
          const rotateY = ((x - midX) / midX) * 2;

          link.style.transform = `translateX(1.5px) rotateX(${-rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
        });

        link.addEventListener('mouseleave', () => {
          link.style.transform = 'translateX(0px) rotateX(0deg) rotateY(0deg) scale(1)';
        });

        const icon = document.createElement("img");
        const fullPath = path ? `${path}/${file.name}` : file.name;
        const iconKey = `${folderId}/${file.name}`;
        icon.src = customIcons[iconKey] || customIcons[file.name] || file.iconLink;
        const colorizedFiles = new Set(["Thrones Extra Modifications.exe"]);
        if (colorizedFiles.has(file.name)) applyGradientToItemFromSrc(li, icon.src);


        icon.alt = "";
        icon.style.height = "20px";
        icon.style.verticalAlign = "middle";
        icon.style.marginRight = "8px";

        link.href = file.webViewLink;
        link.target = "_blank";
        link.appendChild(icon);
        link.appendChild(document.createTextNode(file.name));

        const fileEntry = document.createElement("div");
        fileEntry.className = "file-entry";
        fileEntry.appendChild(link);

        if (file.size) {
          const sizeTag = document.createElement("span");
          sizeTag.className = "file-size-tag";
          sizeTag.textContent = formatBytes(file.size);
          fileEntry.appendChild(sizeTag);
        }

        if (!path) {
          const downloadBtn = document.createElement("button");
          downloadBtn.className = "folder-open-button";
          downloadBtn.onclick = () => window.open(file.webViewLink, "_blank");

          const tooltip = document.createElement("span");
          tooltip.className = "custom-tooltip";
          tooltip.textContent = "Download";
          downloadBtn.appendChild(tooltip);

          const btnIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          btnIcon.setAttribute("width", "16");
          btnIcon.setAttribute("height", "16");
          btnIcon.setAttribute("viewBox", "0 0 24 24");
          btnIcon.setAttribute("fill", "none");
          btnIcon.classList.add("icon-animated");

          const trayPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
          trayPath.setAttribute("d", "M5 20h14a1 1 0 0 0 1-1v-3h-2v2H6v-2H4v3a1 1 0 0 0 1 1z");
          trayPath.setAttribute("fill", "rgba(255, 255, 255, 0.15)");

          const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
          arrowPath.setAttribute("d", "M12 3v10.17l3.59-3.58L17 11l-5 5-5-5 1.41-1.41L11 13.17V3h2z");
          arrowPath.setAttribute("fill", "rgba(255, 255, 255, 0.35)");
          arrowPath.setAttribute("class", "arrow-part");

          btnIcon.appendChild(trayPath);
          btnIcon.appendChild(arrowPath);
          downloadBtn.appendChild(btnIcon);

          fileEntry.appendChild(downloadBtn);
        }

        li.appendChild(fileEntry);
        container.appendChild(li);
      }

      for (const folder of folders) {
        const li = document.createElement("li");

        const folderLink = document.createElement("div");
        folderLink.className = "folder-entry";
        folderLink.style.cursor = "pointer";

        const leftWrapper = document.createElement("div");
        leftWrapper.style.display = "flex";
        leftWrapper.style.alignItems = "center";

        const arrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        arrow.setAttribute("viewBox", "0 0 24 24");
        arrow.setAttribute("class", "folder-arrow");
        arrow.innerHTML = `<path d="M9 5l7 7-7 7"/>`;

        const icon = document.createElement("img");
        icon.crossOrigin = "anonymous";
        const iconSrc = customFolderIcons[folder.id] || folder.iconLink;
        icon.src = iconSrc;
        icon.alt = "";
        icon.style.height = "20px";
        icon.style.verticalAlign = "middle";
        icon.style.marginRight = "8px";

        const nameSpan = document.createElement("span");
        nameSpan.textContent = folder.name;

        const folderBtn = document.createElement("button");
        const tooltip = document.createElement("span");
        folderBtn.className = "folder-open-button";
        tooltip.className = "custom-tooltip";
        tooltip.textContent = "Download";
        folderBtn.appendChild(tooltip);
        folderBtn.onclick = (e) => {
          e.stopPropagation();
          window.open(`https://drive.google.com/drive/folders/${folder.id}`, "_blank");
        };

        const btnIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        btnIcon.setAttribute("width", "16");
        btnIcon.setAttribute("height", "16");
        btnIcon.setAttribute("viewBox", "0 0 24 24");
        btnIcon.setAttribute("fill", "none");
        btnIcon.classList.add("icon-animated");

        const trayPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        trayPath.setAttribute("d", "M5 20h14a1 1 0 0 0 1-1v-3h-2v2H6v-2H4v3a1 1 0 0 0 1 1z");
        trayPath.setAttribute("fill", "rgba(255, 255, 255, 0.15)");

        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M12 3v10.17l3.59-3.58L17 11l-5 5-5-5 1.41-1.41L11 13.17V3h2z");
        arrowPath.setAttribute("fill", "rgba(255, 255, 255, 0.35)");
        arrowPath.setAttribute("class", "arrow-part");

        btnIcon.appendChild(trayPath);
        btnIcon.appendChild(arrowPath);
        folderBtn.appendChild(btnIcon);

        leftWrapper.appendChild(arrow);
        leftWrapper.appendChild(icon);
        leftWrapper.appendChild(nameSpan);

        const rightWrapper = document.createElement("div");
        rightWrapper.style.display = "flex";
        rightWrapper.style.alignItems = "center";
        rightWrapper.style.gap = "1px";

        const sizeTag = document.createElement("span");
        sizeTag.className = "file-size-tag";
        sizeTag.textContent = "...";

        rightWrapper.appendChild(sizeTag);
        rightWrapper.appendChild(folderBtn);

        folderLink.appendChild(leftWrapper);
        folderLink.appendChild(rightWrapper);
        li.appendChild(folderLink);

        applyGradientToItemFromSrc(li, iconSrc, folder.id);

        const subList = document.createElement("ul");
        subList.style.marginLeft = "20px";
        subList.style.display = "none";
        li.appendChild(subList);

        folderLink.addEventListener("click", async () => {
          if (subList.childElementCount === 0) {
            await listFilesInFolder(folder.id, subList, `${path}${folder.name}/`);
          }
          const isOpen = subList.style.display === "block";
          subList.style.display = isOpen ? "none" : "block";
          arrow.classList.toggle("open", !isOpen);

          li.classList.toggle("folder-open", !isOpen);
        });

        nameSpan.style.display = 'inline-block';
        nameSpan.style.transformStyle = 'preserve-3d';
        nameSpan.style.transition = 'transform 0.2s ease';

        nameSpan.addEventListener('mousemove', (e) => {
          const rect = nameSpan.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const midX = rect.width / 2;
          const midY = rect.height / 2;

          const rotateX = ((y - midY) / midY) * 2;
          const rotateY = ((x - midX) / midX) * 2;

          nameSpan.style.transform = `translateX(1.5px) rotateX(${-rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
        });

        nameSpan.addEventListener('mouseleave', () => {
          nameSpan.style.transform = 'translateX(0px) rotateX(0deg) rotateY(0deg) scale(1)';
        });

        fetch(`https://www.googleapis.com/drive/v3/files?q='${folder.id}'+in+parents+and+trashed=false&fields=files(size,mimeType)&key=${apiKey}`)
          .then(res => res.json())
          .then(data => {
            if (!data.files) return;

            const fileCount = data.files.filter(f => f.mimeType !== "application/vnd.google-apps.folder").length;

            const totalSize = data.files
              .filter(f => f.size)
              .reduce((sum, f) => sum + parseInt(f.size), 0);

            sizeTag.textContent = formatBytes(totalSize);

            const countTag = document.createElement("span");
            countTag.className = "file-count-tag";
            countTag.textContent = `${fileCount} Part${fileCount !== 1 ? "s" : ""}`;

            rightWrapper.insertBefore(countTag, folderBtn);
          });

        container.appendChild(li);
      }
    }

    listFilesInFolder(rootFolderId, document.getElementById("fileList"));
  </script>
</body>
</html>